var Baton=function(){var e={},t=null,n=null,r=null,i=null;e.callback=null;var s=null,o=null;e.mappings=[];var u=!1,a={};e.checkSupport=function(){var e=function(){try{return!!navigator.requestMIDIAccess}catch(e){return!1}}();return e},e.connect=function(e){i=e,navigator.requestMIDIAccess().then(c,h)},e.check=function(){return n===null?!1:!0},e.inputs=function(){return s},e.outputs=function(){return o},e.listen=function(t){e.check()===!0?(n.inputs()[t].onmidimessage=p,console.log("Hooked up input # "+t+": "+n.inputs()[t].name)):console.log("Not connected.")},e.send=function(t,r){if(e.check()===!0){var i=[];switch(r.type){case"noteoff":i.push(127+r.channel);break;default:case"note":i.push(143+r.channel);break;case"polypress":i.push(159+r.channel);break;case"control":i.push(175+r.channel);break;case"program":i.push(191+r.channel);break;case"aftertouch":i.push(207+r.channel);break;case"pitchbend":i.push(223+r.channel)}i.push(r.note),i.push(r.value),n.outputs()[t].send(i),console.log("sending to "+n.outputs()[t].name,i)}else console.log("Not connected.")},e.autoMap=function(e,t){d(e),u=!0,a.name=e,a.fn=t},e.autoMapObj=function(e,t){d(e),u=!0,a.name=e,a.fn=function(e){t.value=e.value}};var f=function(){out=[];for(var e in n.inputs())out.push(n.inputs()[e].name);s=out},l=function(){out=[];for(var e in n.outputs())out.push(n.outputs()[e].name);o=out},c=function(e){console.log("connected!"),n=e,f(),l(),typeof i=="function"&&i()},h=function(e){alert("Failed to initialize MIDI - "+(e.code==1?"permission denied":"error code "+e.code))},p=function(t){var n={};if(t.data.length==3){var r=t.data[0];switch(!0){case r>=128&&r<144:n.type="noteoff",n.channel=r-127;break;case r>=144&&r<160:n.type="note",n.channel=r-143;break;case r>=160&&r<176:n.type="polypress",n.channel=r-159;break;case r>=176&&r<192:n.type="control",n.channel=r-175;break;case r>=192&&r<208:n.type="program",n.channel=r-191;break;case r>=208&&r<224:n.type="aftertouch",n.channel=r-207;break;case r>=224:n.type="pitchbend",n.channel=r-223}n.note=parseInt(t.data[1].toString(10)),n.value=parseInt(t.data[2].toString(10)),u===!0&&(a.midi=n,e.mappings.push(a),a={},u=!1);for(var i in e.mappings)n.channel===e.mappings[i].midi.channel&&n.note===e.mappings[i].midi.note&&n.type===e.mappings[i].midi.type&&e.mappings[i].fn(n);typeof e.callback=="function"&&e.callback(n)}},d=function(t){var n=null;for(var r in e.mappings)e.mappings[r].name===t&&(n=r);n&&e.mappings.pop(n)};if(e.checkSupport()===!0)return e;console.log("Looks like your browser doesn't support WebMIDI."),console.log("If you're in OSX Chrome, enable the chrome://flags/#enable-web-midi flag and relaunch Chrome."),console.log("Otherwise try the Jazz-Soft Jazz plugin."),console.log("More info at http://baton.monks.co")};